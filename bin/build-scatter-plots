#!/usr/bin/env python
# vim: set softtabstop=2 ts=2 sw=2 expandtab: 

import MySQLdb
import numpy as np
import matplotlib.pyplot as plt

archiedb=MySQLdb.connect(host='localhost',user='root',passwd='bob123',db='archie')

levels=archiedb.cursor()
levels.execute("""SELECT `level`.`uid`,`level`.`northing`,`level`.`easting`,`site`.`name` FROM `level` LEFT JOIN `site` ON `site`.`uid`=`level`.`site` WHERE `level`.`northing`>0 AND `level`.`easting`>0 AND `closed`='1'""")

level=levels.fetchone()
while level is not None:
  cursor=archiedb.cursor()
  cursor.execute("""SELECT `northing`,`easting`,`elevation` FROM `record` WHERE `level`='%s' AND (`northing`>0 AND `easting`>0 AND `elevation`>0)""",int(level[0]))

  # Easting on the XY plot
  est = ();
  # Northing on the XY plot
  nor = ();
  # Elevation (Y) / Easting (X)
  elv = ();


  print "Fetching cords for Level ", level[0], ' Site:',level[3]
  cords = cursor.fetchone()
  while cords is not None:
    est = est + (cords[1],)
    nor = nor + (cords[0],)
    elv = elv + (cords[2],)
  
    cords = cursor.fetchone()

  # Setup title for the plot
  scattertitle = str(level[3])+"-L-"+str(level[0])+" (Y) Northing / (X) Easting"
  print "Generating scatterplot " + scattertitle
  plt.title(scattertitle)
  plt.ylim(float(level[1]),float(level[1]+1));
  plt.xlim(float(level[2]),float(level[2]+1));
  plt.scatter(est,nor,marker='x')
  plt.show()
  # Fetch the next level
  level = levels.fetchone()
#N = 50
#x = np.random.rand(N)
#y = np.random.rand(N)
#colors = np.random.rand(N)
#area = np.pi * (15 * np.random.rand(N))**2 # 0 to 15 point radiuses
# Scatter ( X, Y, )
#plt.title('Level 14 (X) Easting / (Y) Northing',weight='bold')
#plt.scatter(est, nor,marker='x')
#plt.show()
#plt.savefig('estnor.png')
#plt.scatter(est,elv,marker='x')
#plt.savefig('estelv.png')
#plt.scatter(nor,elv,marker='x')
#plt.savefig('norelv.png')
##
